var Ni=Object.defineProperty,Oi=Object.defineProperties;var $i=Object.getOwnPropertyDescriptors;var gt=Object.getOwnPropertySymbols;var Ue=Object.prototype.hasOwnProperty,Ve=Object.prototype.propertyIsEnumerable;var Fe=(i,t,e)=>t in i?Ni(i,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):i[t]=e,p=(i,t)=>{for(var e in t||(t={}))Ue.call(t,e)&&Fe(i,e,t[e]);if(gt)for(var e of gt(t))Ve.call(t,e)&&Fe(i,e,t[e]);return i},D=(i,t)=>Oi(i,$i(t));var jt=(i,t)=>{var e={};for(var n in i)Ue.call(i,n)&&t.indexOf(n)<0&&(e[n]=i[n]);if(i!=null&&gt)for(var n of gt(i))t.indexOf(n)<0&&Ve.call(i,n)&&(e[n]=i[n]);return e};function Mi(i){return`/${i.replace(/~/g,"~0").replace(/\//g,"~1")}`}function qe(i){return i.indexOf("~")?i.replace(/~1/g,"/").replace(/~0/g,"~"):i}function Ri(i){return(i.startsWith("/")?i.substring(1):i).split("/").map(e=>qe(e))}function Fi(i){return!i.startsWith("/")}function Ui(i){return!i.match(/\/\/|(^\/.*~[^0|^1])|~$/)}var T=class{constructor(t,e=!1){if(e){let n=t;this.h=[n],this.isValid=n!=="",this.redactionName=n.startsWith("/")?Mi(n):n}else{if(this.redactionName=t,t===""||t==="/"||!Ui(t)){this.isValid=!1,this.h=[];return}Fi(t)?this.h=[t]:t.indexOf("/",1)<0?this.h=[qe(t.slice(1))]:this.h=Ri(t),this.h[0]==="_meta"?this.isValid=!1:this.isValid=!0}}get(t){let{h:e,isValid:n}=this;if(!n)return;let s=t;for(let r=0;r<e.length;r+=1){let a=e[r];if(s!=null&&Object.prototype.hasOwnProperty.call(s,a)&&typeof s=="object"&&!Array.isArray(s))s=s[a];else return}return s}getComponent(t){return this.h[t]}get depth(){return this.h.length}get isKind(){return this.h.length===1&&this.h[0]==="kind"}compare(t){return this.depth===t.depth&&this.h.every((e,n)=>e===t.getComponent(n))}};T.InvalidReference=new T("");var _t=class{is(t){if(Array.isArray(t))return!1;let n=typeof t;return n==="function"||n==="object"}getType(){return"factory method or object"}},A=class{constructor(t,e){this.Dt=t,this.typeOf=typeof e}is(t){return Array.isArray(t)?!1:typeof t===this.typeOf}getType(){return this.Dt}},vt=class{constructor(t,e){this.Dt=t,this.typeOf=typeof e}is(t){return Array.isArray(t)?t.length>0?t.every(e=>typeof e===this.typeOf):!0:!1}getType(){return this.Dt}},G=class extends A{constructor(t){super(`number with minimum value of ${t}`,0),this.min=t}is(t){return typeof t===this.typeOf&&t>=this.min}},wt=class extends A{constructor(t){super(`string matching ${t}`,""),this.expression=t}is(t){return typeof t=="string"&&!!t.match(this.expression)}},Kt=class{is(t){return typeof t=="function"}getType(){return"function"}},Gt=class{is(t){return typeof t=="boolean"||typeof t=="undefined"||t===null}getType(){return"boolean | undefined | null"}},Vi=/^\d\d\d\d-\d\d-\d\dT\d\d:\d\d:\d\d(\.\d\d*)?(Z|[-+]\d\d(:\d\d)?)/,zt=class{is(t){return typeof t=="number"||typeof t=="string"&&Vi.test(t)}getType(){return"date"}},qt=class extends wt{constructor(){super(/^(\w|\.|-)+$/)}is(t){return super.is(t)&&t!=="kind"}},u=class{static createTypeArray(t,e){return new vt(t,e)}static numberWithMin(t){return new G(t)}static stringMatchingRegex(t){return new wt(t)}};u.String=new A("string","");u.Number=new A("number",0);u.ObjectOrFactory=new _t;u.Object=new A("object",{});u.StringArray=new vt("string[]","");u.Boolean=new A("boolean",!0);u.Function=new Kt;u.Date=new zt;u.Kind=new qt;u.NullableBoolean=new Gt;function Je(i){return"kind"in i?u.String.is(i.kind)&&i.kind!=="multi":!1}function We(i){return"kind"in i?u.String.is(i.kind)&&i.kind==="multi":!1}function Ye(i){return!("kind"in i)||i.kind===null||i.kind===void 0}var Jt="user";function je(i){return i.includes("%")||i.includes(":")?i.replace(/%/g,"%25").replace(/:/g,"%3A"):i}function ji(i){return i&&u.Object.is(i)}function He(i){return u.Kind.is(i)}function Be(i){return u.String.is(i)&&i!==""}function Ht(i,t=!1){return i?i.map(e=>new T(e,t)):[]}function Hi(i){return i!=null}function Bi(i){let t=D(p({},i.custom||[]),{kind:"user",key:String(i.key)});if(Hi(i.anonymous)){let e=!!i.anonymous;delete t.anonymous,t.anonymous=e}return i.name!==null&&i.name!==void 0&&(t.name=i.name),i.ip!==null&&i.ip!==void 0&&(t.ip=i.ip),i.firstName!==null&&i.firstName!==void 0&&(t.firstName=i.firstName),i.lastName!==null&&i.lastName!==void 0&&(t.lastName=i.lastName),i.email!==null&&i.email!==void 0&&(t.email=i.email),i.avatar!==null&&i.avatar!==void 0&&(t.avatar=i.avatar),i.country!==null&&i.country!==void 0&&(t.country=i.country),i.privateAttributeNames!==null&&i.privateAttributeNames!==void 0&&(t._meta={privateAttributes:i.privateAttributeNames}),t}var k=class i{constructor(t,e,n){this.k=!1,this.nt=!1,this.ne=!1,this.P={},this.kind=e,this.valid=t,this.message=n}static w(t,e){return new i(!1,t,e)}static Ke(t,e){if(!(!e||!t.isValid))return t.depth===1&&t.getComponent(0)==="anonymous"?!!(e!=null&&e.anonymous):t.get(e)}se(t){if(this.k)return this.P[t];if(this.kind===t)return this.N}static Ge(t){let e=Object.keys(t).filter(c=>c!=="kind"),n=e.every(He);if(!e.length)return i.w("multi","A multi-kind context must contain at least one kind");if(!n)return i.w("multi","Context contains invalid kinds");let s={},r=!0,a=e.reduce((c,l)=>{var d;let h=t[l];return ji(h)?(c[l]=h,s[l]=Ht((d=h._meta)==null?void 0:d.privateAttributes)):r=!1,c},{});if(!r)return i.w("multi","Context contained contexts that were not objects");if(!Object.values(a).every(c=>Be(c.key)))return i.w("multi","Context contained invalid keys");if(e.length===1){let c=e[0],l=new i(!0,c);return l.N=D(p({},a[c]),{kind:c}),l.st=s,l.nt=c==="user",l}let o=new i(!0,t.kind);return o.P=a,o.st=s,o.k=!0,o}static ze(t){var c;let{key:e,kind:n}=t,s=He(n),r=Be(e);if(!s)return i.w(n!=null?n:"unknown","The kind was not valid for the context");if(!r)return i.w(n,"The key for the context was not valid");let a=Ht((c=t._meta)==null?void 0:c.privateAttributes),o=new i(!0,n);return o.nt=n==="user",o.N=t,o.st={[n]:a},o}static qe(t){if(!(t.key!==void 0&&t.key!==null))return i.w("user","The key for the context was not valid");let n=new i(!0,"user");return n.nt=!0,n.ne=!0,n.N=Bi(t),n.st={user:Ht(t.privateAttributeNames,!0)},n}static fromLDContext(t){return t?Je(t)?i.ze(t):We(t)?i.Ge(t):Ye(t)?i.qe(t):i.w("unknown","Context was not of a valid kind"):i.w("unknown","No context specified. Returning default value")}static toLDContext(t){if(!t.valid)return;let e=t.getContexts();if(!t.k)return e[0][1];let n={kind:"multi"};return e.forEach(s=>{let r=s[0],a=s[1];n[r]=a}),n}valueForKind(t,e=Jt){return t.isKind?this.kinds:i.Ke(t,this.se(e))}key(t=Jt){var e;return(e=this.se(t))==null?void 0:e.key}get isMultiKind(){return this.k}get canonicalKey(){return this.nt?this.N.key:this.k?Object.keys(this.P).sort().map(t=>`${t}:${je(this.P[t].key)}`).join(":"):`${this.kind}:${je(this.N.key)}`}get kinds(){return this.k?Object.keys(this.P):[this.kind]}get kindsAndKeys(){return this.k?Object.entries(this.P).reduce((t,[e,n])=>(t[e]=n.key,t),{}):{[this.kind]:this.N.key}}privateAttributes(t){var e;return((e=this.st)==null?void 0:e[t])||[]}getContexts(){return this.k?Object.entries(this.P):[[this.kind,this.N]]}get legacy(){return this.ne}};k.UserKind=Jt;var _i=["key","kind","_meta","anonymous"].map(i=>new T(i,!0)),Ki=["name","ip","firstName","lastName","email","avatar","country"];function Gi(i,t){return i.depth===t.length&&t.every((e,n)=>e===i.getComponent(n))}function zi(i,t){let e=[],n={},s=[];for(e.push(...Object.keys(i).map(r=>({key:r,ptr:[r],source:i,parent:n,visited:[i]})));e.length;){let r=e.pop(),a=t.find(o=>Gi(o,r.ptr));if(a)s.push(a.redactionName);else{let o=r.source[r.key];o===null?r.parent[r.key]=o:Array.isArray(o)?r.parent[r.key]=[...o]:typeof o=="object"?r.visited.includes(o)||(r.parent[r.key]={},e.push(...Object.keys(o).map(c=>({key:c,ptr:[...r.ptr,c],source:o,parent:r.parent[r.key],visited:[...r.visited,o]})))):r.parent[r.key]=o}}return{cloned:n,excluded:s.sort()}}var Wt=class{constructor(t,e){this.Je=t,this.We=e}filter(t,e=!1){let n=t.getContexts();if(n.length===1)return this.re(t,n[0][1],n[0][0],e);let s={kind:"multi"};return n.forEach(([r,a])=>{s[r]=this.re(t,a,r,e)}),s}Ye(t,e,n,s){return(s?Object.keys(e).map(r=>new T(r,!0)):[...this.We,...t.privateAttributes(n)]).filter(r=>!_i.some(a=>a.compare(r)))}re(t,e,n,s){let r=this.Je||s&&e.anonymous===!0,{cloned:a,excluded:o}=zi(e,this.Ye(t,e,n,r));return t.legacy&&Ki.forEach(c=>{c in a&&(a[c]=String(a[c]))}),o.length&&(a._meta||(a._meta={}),a._meta.redactedAttributes=o),a._meta&&(delete a._meta.privateAttributes,Object.keys(a._meta).length===0&&delete a._meta),a}},_e=30*1e3,qi=.5,Et=class{constructor(t,e,n=Math.random){this.Ze=e,this.Xe=n,this.bt=0,this.ae=Math.max(1,t),this.Qe=Math.ceil(Math.log2(_e/this.ae))}x(){let t=Math.min(this.bt,this.Qe),e=this.ae*2**t;return Math.min(e,_e)}ti(t){return t-Math.trunc(this.Xe()*qi*t)}success(t=Date.now()){this.kt=t}fail(t=Date.now()){this.kt!==void 0&&t-this.kt>this.Ze&&(this.bt=0),this.kt=void 0;let e=this.ti(this.x());return this.bt+=1,e}};var Ke;(function(i){i[i.Valid=0]="Valid",i[i.Initializing=1]="Initializing",i[i.Interrupted=2]="Interrupted",i[i.Closed=3]="Closed"})(Ke||(Ke={}));var gs=2*60*1e3,ms=5*60*1e3;var w;(function(i){i.Unknown="UNKNOWN",i.NetworkError="NETWORK_ERROR",i.ErrorResponse="ERROR_RESPONSE",i.InvalidData="INVALID_DATA"})(w||(w={}));var O=class extends Error{constructor(t,e,n,s=!0){super(e),this.kind=t,this.status=n,this.name="LaunchDarklyPollingError",this.recoverable=s}},U=class extends Error{constructor(t,e,n,s=!0){super(e),this.kind=t,this.code=n,this.name="LaunchDarklyStreamingError",this.recoverable=s}},V;(function(i){i[i.Disabled=0]="Disabled",i[i.Enabled=1]="Enabled"})(V||(V={}));var j;(function(i){i[i.AnalyticsEvents=0]="AnalyticsEvents",i[i.DiagnosticEvent=1]="DiagnosticEvent"})(j||(j={}));var N;(function(i){i[i.Succeeded=0]="Succeeded",i[i.Failed=1]="Failed",i[i.FailedAndMustShutDown=2]="FailedAndMustShutDown"})(N||(N={}));function F(i){if(typeof i=="string")return i;if(i===void 0)return"undefined";if(i===null)return"null";if(Object.prototype.hasOwnProperty.call(i,"toString"))try{return i.toString()}catch(t){}if(typeof i=="bigint")return`${i}n`;try{return JSON.stringify(i)}catch(t){return t instanceof TypeError&&t.message.indexOf("circular")>=0?"[Circular]":"[Not Stringifiable]"}}function Ji(i){return typeof i=="symbol"?"NaN":typeof i=="bigint"?`${i}n`:String(Number(i))}function Wi(i){return typeof i=="symbol"?"NaN":typeof i=="bigint"?`${i}n`:String(parseInt(i,10))}function Yi(i){return typeof i=="symbol"?"NaN":String(parseFloat(i))}var mt={s:i=>F(i),d:i=>Ji(i),i:i=>Wi(i),f:i=>Yi(i),j:i=>F(i),o:i=>F(i),O:i=>F(i),c:()=>""};function Yt(...i){var e;let t=i.shift();if(u.String.is(t)){let n="",s=0;for(;s<t.length;){let r=t.charAt(s);if(r==="%"){if(s+1<t.length){let o=t.charAt(s+1);if(o in mt&&i.length){let c=i.shift();n+=(e=mt[o])==null?void 0:e.call(mt,c)}else o==="%"?n+="%":n+=`%${o}`;s+=2}}else n+=r,s+=1}return i.length&&(n.length&&(n+=" "),n+=i.map(F).join(" ")),n}return i.map(F).join(" ")}var v;(function(i){i[i.debug=0]="debug",i[i.info=1]="info",i[i.warn=2]="warn",i[i.error=3]="error",i[i.none=4]="none"})(v||(v={}));var Zi=["debug","info","warn","error","none"],$=class i{static get(){return new i({})}constructor(t){var e,n,s;if(this.ci=(n=v[(e=t.level)!=null?e:"info"])!=null?n:v.info,this.li=(s=t.name)!=null?s:"LaunchDarkly",this.ue=t.formatter,typeof t.destination=="object")this.he={[v.debug]:t.destination.debug,[v.info]:t.destination.info,[v.warn]:t.destination.warn,[v.error]:t.destination.error};else if(typeof t.destination=="function"){let{destination:r}=t;this.he={[v.debug]:r,[v.info]:r,[v.warn]:r,[v.error]:r}}}ui(...t){var e;try{return this.ue?(e=this.ue)==null?void 0:e.call(this,...t):Yt(...t)}catch(n){return Yt(...t)}}hi(t,e){try{t(e)}catch(n){console.error(e)}}E(t,e){var n;if(t>=this.ci){let s=`${Zi[t]}: [${this.li}]`;try{let r=(n=this.he)==null?void 0:n[t];r?this.hi(r,`${s} ${this.ui(...e)}`):console.error(...e)}catch(r){console.error(...e)}}}error(...t){this.E(v.error,t)}warn(...t){this.E(v.warn,t)}info(...t){this.E(v.info,t)}debug(...t){this.E(v.debug,t)}},Xi={error:u.Function,warn:u.Function,info:u.Function,debug:u.Function},z=class{constructor(t,e){Object.entries(Xi).forEach(([n,s])=>{if(!s.is(t[n]))throw new Error(`Provided logger instance must support logger.${n}(...) method`)}),this.t=t,this.di=e}E(t,e){try{this.t[t](...e)}catch(n){this.di[t](...e)}}error(...t){this.E("error",t)}warn(...t){this.E("warn",t)}info(...t){this.E("info",t)}debug(...t){this.E("debug",t)}},ce=i=>{let t=new $({level:"info",destination:console.error,formatter:Yt});return i?new z(i,t):t},b=class{static deprecated(t,e){return`"${t}" is deprecated, please use "${e}"`}static optionBelowMinimum(t,e,n){return`Config option "${t}" had invalid value of ${e}, using minimum of ${n} instead`}static unknownOption(t){return`Ignoring unknown config option "${t}"`}static wrongOptionType(t,e,n){return`Config option "${t}" should be of type ${e}, got ${n}, using default value`}static wrongOptionTypeBoolean(t,e){return`Config option "${t}" should be a boolean, got ${e}, converting to boolean`}static invalidTagValue(t){return`Config option "${t}" must only contain letters, numbers, ., _ or -.`}static tagValueTooLong(t){return`Value of "${t}" was longer than 64 characters and was discarded.`}static partialEndpoint(t){return`You have set custom uris without specifying the ${t} URI; connections may not work properly`}},Qi=/^(\w|\.|-)+$/,tn=u.stringMatchingRegex(Qi),en={is:(i,t)=>tn.is(i)?i.length>64?{valid:!1,message:b.tagValueTooLong(t)}:{valid:!0}:{valid:!1,message:b.invalidTagValue(t)}},Dt=class{constructor(t){let e={},n=t==null?void 0:t.application,s=t==null?void 0:t.logger;n&&Object.entries(n).forEach(([a,o])=>{if(o!=null){let{valid:c,message:l}=en.is(o,`application.${a}`);c?a==="versionName"?e["application-version-name"]=[o]:e[`application-${a}`]=[o]:s==null||s.warn(l)}});let r=Object.keys(e);r.length&&(this.value=r.sort().flatMap(a=>e[a].sort().map(o=>`${a}/${o}`)).join(" "))}},bt=class{constructor(t,e,n){this.platform=n,this.basicConfiguration={tags:e.tags,logger:e.logger,offline:e.offline,serviceEndpoints:e.serviceEndpoints,sdkKey:t}}};function Bt(i){return i.replace(/\/+$/,"")}function le(i){return i.replace(/^\/+/,"").replace(/\?$/,"")}var M=class i{constructor(t,e,n=i.DEFAULT_EVENTS,s="/bulk",r="/diagnostic",a=!0,o){this.streaming=Bt(t),this.polling=Bt(e),this.events=Bt(n),this.analyticsEventPath=s,this.diagnosticEventPath=r,this.includeAuthorizationHeader=a,this.payloadFilterKey=o}};M.DEFAULT_EVENTS="https://events.launchdarkly.com";function ue(i,t){if(t.length===0)return i;let e=t.map(({key:n,value:s})=>`${n}=${s}`);return`${i}?${e.join("&")}`}function Ze(i,t,e){let n=le(t),s=[...e];return i.payloadFilterKey&&s.push({key:"filter",value:i.payloadFilterKey}),ue(`${i.streaming}/${n}`,s)}function Xe(i,t,e){let n=le(t),s=[...e];return i.payloadFilterKey&&s.push({key:"filter",value:i.payloadFilterKey}),ue(`${i.polling}/${n}`,s)}function Ge(i,t,e){let n=le(t);return ue(`${i.events}/${n}`,e)}var q=class extends Error{constructor(t){super(t),this.name="LaunchDarklyUnexpectedResponseError"}},J=class extends Error{constructor(t){super(t),this.name="LaunchDarklyClientError"}},H=class extends Error{constructor(t){super(t),this.name="LaunchDarklyTimeoutError"}};function Y(i){return i>=400&&i<500?i===400||i===408||i===429:!0}function nn(i){return i===413?!0:Y(i)}function Qe(i,t){let e,n;return{promise:new Promise((r,a)=>{n=r,e=setTimeout(()=>{let o=`${t} timed out after ${i} seconds.`;a(new H(o))},i*1e3)}),cancel:()=>{n(),clearTimeout(e)}}}function he(i){return i==null?i:JSON.parse(JSON.stringify(i))}function Tt(i){return Math.trunc(i*1e3)}var sn=i=>JSON.stringify(i)==="{}",At=(i,t)=>i&&Object.entries(i).reduce((e,[n,s])=>(s&&!sn(s)&&!(t!=null&&t.includes(n))&&(e[n]=typeof s=="object"?At(s,t):s),e),{});function K(i,t){if(i===t)return!0;if(i&&t&&typeof i=="object"&&typeof t=="object"){if(i.constructor!==t.constructor)return!1;var e,n,s;if(Array.isArray(i)){if(e=i.length,e!=t.length)return!1;for(n=e;n--!==0;)if(!K(i[n],t[n]))return!1;return!0}if(i instanceof Map&&t instanceof Map){if(i.size!==t.size)return!1;for(n of i.entries())if(!t.has(n[0]))return!1;for(n of i.entries())if(!K(n[1],t.get(n[0])))return!1;return!0}if(i instanceof Set&&t instanceof Set){if(i.size!==t.size)return!1;for(n of i.entries())if(!t.has(n[0]))return!1;return!0}if(ArrayBuffer.isView(i)&&ArrayBuffer.isView(t)){if(e=i.length,e!=t.length)return!1;for(n=e;n--!==0;)if(i[n]!==t[n])return!1;return!0}if(i.constructor===RegExp)return i.source===t.source&&i.flags===t.flags;if(i.valueOf!==Object.prototype.valueOf)return i.valueOf()===t.valueOf();if(i.toString!==Object.prototype.toString)return i.toString()===t.toString();if(s=Object.keys(i),e=s.length,e!==Object.keys(t).length)return!1;for(n=e;n--!==0;)if(!Object.prototype.hasOwnProperty.call(t,s[n]))return!1;for(n=e;n--!==0;){var r=s[n];if(!K(i[r],t[r]))return!1}return!0}return i!==i&&t!==t}function ti(i,t,e,n=!0,s="user-agent"){let{userAgentBase:r,version:a,wrapperName:o,wrapperVersion:c}=t.sdkData(),l={[s]:`${r!=null?r:"NodeJSClient"}/${a}`};return n&&(l.authorization=i),o&&(l["x-launchdarkly-wrapper"]=c?`${o}/${c}`:o),e!=null&&e.value&&(l["x-launchdarkly-tags"]=e.value),l}function B(i,t,e){let n;i.status?n=`error ${i.status}${i.status===401?" (invalid SDK key)":""}`:n=`I/O error (${i.message||"unknown error"})`;let s=e!=null?e:"giving up permanently";return`Received ${n} for ${t} - ${s}`}function ei({status:i}){return i?Y(i):!0}var de=(i,t)=>t.btoa(i).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"");var rn=async(i=1e3)=>new Promise(t=>{setTimeout(t,i)}),ii=(i,t)=>new Promise((e,n)=>{setTimeout(()=>{let s=`${t} timed out after ${i} seconds.`;n(new H(s))},i*1e3)}),Zt=class{constructor(t,e,n){this.l=e,this.fi=n,this.Lt=[],this.de=Date.now(),this.fe=this.de,this.pe={diagnosticId:e.crypto.randomUUID(),sdkKeySuffix:t.length>6?t.substring(t.length-6):t}}createInitEvent(){var n,s,r;let t=this.l.info.sdkData(),e=this.l.info.platformData();return{kind:"diagnostic-init",id:this.pe,creationDate:this.de,sdk:t,configuration:this.fi,platform:p({name:e.name,osArch:(n=e.os)==null?void 0:n.arch,osName:(s=e.os)==null?void 0:s.name,osVersion:(r=e.os)==null?void 0:r.version},e.additional||{})}}recordStreamInit(t,e,n){let s={timestamp:t,failed:e,durationMillis:n};this.Lt.push(s)}createStatsEventAndReset(t,e,n){let s=Date.now(),r={kind:"diagnostic",id:this.pe,creationDate:s,dataSinceDate:this.fe,droppedEvents:t,deduplicatedUsers:e,eventsInLastBatch:n,streamInits:this.Lt};return this.Lt=[],this.fe=s,r}},Xt;(function(i){i.MalformedFlag="MALFORMED_FLAG",i.UserNotSpecified="USER_NOT_SPECIFIED",i.FlagNotFound="FLAG_NOT_FOUND",i.ClientNotReady="CLIENT_NOT_READY",i.WrongType="WRONG_TYPE"})(Xt||(Xt={}));var an=Xt,kt=class{static invalidMetricValue(t){return`The track function was called with a non-numeric "metricValue" (${t}), only numeric metric values are supported.`}};kt.MissingContextKeyNoEvent="Context was unspecified or had no key; event will not be sent";var Qt=class{constructor(t,e){let{basicConfiguration:n,platform:s}=t,{serviceEndpoints:{analyticsEventPath:r,diagnosticEventPath:a}}=n,{crypto:o,requests:c}=s;this.pi=p({},e),this.ge=Ge(n.serviceEndpoints,r,[]),this.gi=Ge(n.serviceEndpoints,a,[]),this.L=c,this.mi=o}async rt(t,e,n,s){let r={status:N.Succeeded},a=D(p({},this.pi),{"content-type":"application/json"});n&&(a["x-launchdarkly-payload-id"]=n,a["x-launchDarkly-event-schema"]="4");let o;try{let{status:c,headers:l}=await this.L.fetch(e,{headers:a,body:JSON.stringify(t),compressBodyIfPossible:!0,method:"POST",keepalive:!0}),h=Date.parse(l.get("date")||"");if(h&&(r.serverTime=h),c<=204)return r;if(o=new q(B({status:c,message:"some events were dropped"},"event posting")),!Y(c))return nn(c)?r.status=N.Failed:r.status=N.FailedAndMustShutDown,r.error=o,r}catch(c){o=c}return o&&!s?(r.status=N.Failed,r.error=o,r):(await rn(),this.rt(t,this.ge,n,!1))}async sendEventData(t,e){let n=t===j.AnalyticsEvents?this.mi.randomUUID():void 0,s=t===j.AnalyticsEvents?this.ge:this.gi;return this.rt(e,s,n,!0)}};function te(i){return i.kind==="feature"}function on(i){return i.kind==="identify"}function cn(i){return i.kind==="migration_op"}var ee=class{constructor(t,e,n,s,r,a){this.count=t,this.key=e,this.value=n,this.version=r,this.variation=a,this.default=s}increment(){this.count+=1}};function ln(i){return`${i.key}:${i.variation!==null&&i.variation!==void 0?i.variation:""}:${i.version!==null&&i.version!==void 0?i.version:""}`}var ie=class{constructor(){this.Z=0,this.at=0,this.ot={},this.ct={}}summarizeEvent(t){if(te(t)&&!t.excludeFromSummaries){let e=ln(t),n=this.ot[e],s=this.ct[t.key];s||(s=new Set,this.ct[t.key]=s),t.context.kinds.forEach(r=>s.add(r)),n?n.increment():this.ot[e]=new ee(1,t.key,t.value,t.default,t.version,t.variation),(this.Z===0||t.creationDate<this.Z)&&(this.Z=t.creationDate),t.creationDate>this.at&&(this.at=t.creationDate)}}getSummary(){let t=Object.values(this.ot).reduce((e,n)=>{let s=e[n.key];s||(s={default:n.default,counters:[],contextKinds:[...this.ct[n.key]]},e[n.key]=s);let r={value:n.value,count:n.count};return n.variation!==void 0&&n.variation!==null&&(r.variation=n.variation),n.version!==void 0&&n.version!==null?r.version=n.version:r.unknown=!0,s.counters.push(r),e},{});return{startDate:this.Z,endDate:this.at,features:t,kind:"summary"}}clearSummary(){this.Z=0,this.at=0,this.ot={},this.ct={}}},ne=class extends Error{constructor(t){super(t),this.name="LaunchDarklyInvalidSDKKeyError"}};function yt(i){let t=Math.trunc(i);return t===1?!0:t===0?!1:Math.floor(Math.random()*t)===0}var se=class{constructor(t,e,n,s,r,a=!0){this.r=t,this.lt=s,this.D=r,this.Ct=new ie,this.ut=[],this.me=0,this.Tt=0,this.At=0,this.It=!1,this.ye=0,this.Pt=!1,this.Nt=null,this.yi=t.eventsCapacity,this.t=e.basicConfiguration.logger,this.ve=new Qt(e,n),this.ht=new Wt(t.allAttributesPrivate,t.privateAttributes.map(o=>new T(o))),a&&this.start()}start(){var t,e;if(((t=this.lt)==null?void 0:t.flushInterval)!==void 0&&(this.Nt=setInterval(()=>{var n;(n=this.lt)==null||n.flush()},this.lt.flushInterval*1e3)),this.vi=setInterval(async()=>{var n;try{await this.flush()}catch(s){(n=this.t)==null||n.debug(`Flush failed: ${s}`)}},this.r.flushInterval*1e3),this.D){let n=this.D.createInitEvent();this.we(n),this.Ee=setInterval(()=>{let s=this.D.createStatsEventAndReset(this.Tt,this.At,this.ye);this.Tt=0,this.At=0,this.we(s)},this.r.diagnosticRecordingInterval*1e3)}(e=this.t)==null||e.debug("Started EventProcessor.")}we(t){this.ve.sendEventData(j.DiagnosticEvent,t)}close(){clearInterval(this.vi),this.Nt&&clearInterval(this.Nt),this.Ee&&clearInterval(this.Ee)}async flush(){var n;if(this.Pt)throw new ne("Events cannot be posted because a permanent error has been encountered. This is most likely an invalid SDK key. The specific error information is logged independently.");let t=this.ut;this.ut=[];let e=this.Ct.getSummary();this.Ct.clearSummary(),Object.keys(e.features).length&&t.push(e),t.length&&(this.ye=t.length,(n=this.t)==null||n.debug("Flushing %d events",t.length),await this.rt(t))}sendEvent(t){var c;if(this.Pt)return;if(cn(t)){if(yt(t.samplingRatio)){let l=D(p({},t),{context:t.context?this.ht.filter(t.context):void 0});l.samplingRatio===1&&delete l.samplingRatio,this.dt(l)}return}this.Ct.summarizeEvent(t);let e=te(t),n=e&&t.trackEvents||!e,s=this.wi(t),r=on(t),a=(c=this.lt)==null?void 0:c.processContext(t.context);a||r||(this.At+=1),a&&!r&&this.dt(this.Ot({kind:"index",creationDate:t.creationDate,context:t.context,samplingRatio:1},!1)),n&&yt(t.samplingRatio)&&this.dt(this.Ot(t,!1)),s&&yt(t.samplingRatio)&&this.dt(this.Ot(t,!0))}Ot(t,e){switch(t.kind){case"feature":{let n={kind:e?"debug":"feature",creationDate:t.creationDate,context:this.ht.filter(t.context,!e),key:t.key,value:t.value,default:t.default};return t.samplingRatio!==1&&(n.samplingRatio=t.samplingRatio),t.prereqOf&&(n.prereqOf=t.prereqOf),t.variation!==void 0&&(n.variation=t.variation),t.version!==void 0&&(n.version=t.version),t.reason&&(n.reason=t.reason),n}case"index":case"identify":{let n={kind:t.kind,creationDate:t.creationDate,context:this.ht.filter(t.context)};return t.samplingRatio!==1&&(n.samplingRatio=t.samplingRatio),n}case"custom":{let n={kind:"custom",creationDate:t.creationDate,key:t.key,context:this.ht.filter(t.context)};return t.samplingRatio!==1&&(n.samplingRatio=t.samplingRatio),t.data!==void 0&&(n.data=t.data),t.metricValue!==void 0&&(n.metricValue=t.metricValue),t.url!==void 0&&(n.url=t.url),n}case"click":return{kind:"click",creationDate:t.creationDate,contextKeys:t.context.kindsAndKeys,key:t.key,url:t.url,selector:t.selector};case"pageview":return{kind:"pageview",creationDate:t.creationDate,contextKeys:t.context.kindsAndKeys,key:t.key,url:t.url};default:return t}}dt(t){var e;this.ut.length<this.yi?(this.ut.push(t),this.It=!1):(this.It||(this.It=!0,(e=this.t)==null||e.warn("Exceeded event queue capacity. Increase capacity to avoid dropping events.")),this.Tt+=1)}wi(t){return te(t)&&t.debugEventsUntilDate&&t.debugEventsUntilDate>this.me&&t.debugEventsUntilDate>Date.now()}async rt(t){let e=await this.ve.sendEventData(j.AnalyticsEvents,t);if(e.status===N.FailedAndMustShutDown&&(this.Pt=!0),e.serverTime&&(this.me=e.serverTime),e.error)throw e.error}},xt=class{constructor(t,e,n,s,r=1,a){this.context=t,this.key=e,this.data=n,this.metricValue=s,this.samplingRatio=r,this.url=a,this.kind="custom",this.creationDate=Date.now(),this.context=t}},W=class{constructor(t,e,n,s,r,a,o,c,l,h,d,f,g=1){this.withReasons=t,this.context=e,this.key=n,this.samplingRatio=g,this.kind="feature",this.creationDate=Date.now(),this.value=s,this.default=r,a!==void 0&&(this.version=a),o!==void 0&&(this.variation=o),c!==void 0&&(this.trackEvents=c),l!==void 0&&(this.prereqOf=l),h!==void 0&&(this.reason=h),d!==void 0&&(this.debugEventsUntilDate=d),f!==void 0&&(this.excludeFromSummaries=f)}},St=class{constructor(t,e=1){this.context=t,this.samplingRatio=e,this.kind="identify",this.creationDate=Date.now()}},re=class{close(){}async flush(){}sendEvent(){}},ae=class{constructor(t){this.$t=t}evalEvent(t){var e;return new W(this.$t,t.context,t.flagKey,t.value,t.defaultVal,t.version,(e=t.variation)!=null?e:void 0,t.trackEvents||t.addExperimentData,t.prereqOfFlagKey,this.$t||t.addExperimentData?t.reason:void 0,t.debugEventsUntilDate,t.excludeFromSummaries,t.samplingRatio)}unknownFlagEvent(t,e,n){return new W(this.$t,n,t,e,e,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0)}identifyEvent(t){return new St(t,1)}customEvent(t,e,n,s,r=1){return new xt(e,t,n!=null?n:void 0,s!=null?s:void 0,r)}},Lt=class{constructor(t,e,n){this.Ei=t,this.u=e,this.t=n,this.e=[],this.$=void 0,this.H=!1,this.B=[],this.Di=s=>{if(this.Mt(),!s.payloads.length)return;let r=s.payloads[0];switch(r==null?void 0:r.code){case"xfer-full":this.H=!0;break;case"xfer-changes":this.H=!1;break;case"none":this.H=!1,this.bi(r);break;default:return}this.$=r==null?void 0:r.id},this.ki=s=>{var a;if(!this.$||!s.kind||!s.key||!s.version||!s.object)return;let r=this.xi(s.kind,s.object);if(!r){(a=this.t)==null||a.warn(`Unable to process object for kind: '${s.kind}'`);return}this.B.push({kind:s.kind,key:s.key,version:s.version,object:r})},this.Si=s=>{!this.$||!s.kind||!s.key||!s.version||this.B.push({kind:s.kind,key:s.key,version:s.version,deleted:!0})},this.bi=s=>{if(!s.id||!s.target)return;let r={id:s.id,version:s.target,basis:!1,updates:[]};this.e.forEach(a=>a(r)),this.De()},this.Li=s=>{if(!this.$||!s.state||!s.version){this.Mt();return}let r={id:this.$,version:s.version,state:s.state,basis:this.H,updates:this.B};this.e.forEach(a=>a(r)),this.De()},this.Ci=s=>{var r;(r=this.t)==null||r.info(`Goodbye was received from the LaunchDarkly connection with reason: ${s.reason}.`),this.Mt()},this.Ti=s=>{var r;(r=this.t)==null||r.info(`An issue was encountered receiving updates for payload ${this.$} with reason: ${s.reason}.`),this.Ai()}}addPayloadListener(t){this.e.push(t)}removePayloadListener(t){let e=this.e.indexOf(t,0);e>-1&&this.e.splice(e,1)}processEvents(t){t.forEach(e=>{switch(e.event){case"server-intent":{this.Di(e.data);break}case"put-object":{this.ki(e.data);break}case"delete-object":{this.Si(e.data);break}case"payload-transferred":{this.Li(e.data);break}case"goodbye":{this.Ci(e.data);break}case"error":{this.Ti(e.data);break}}})}xi(t,e){var n,s;return(s=(n=this.Ei)[t])==null?void 0:s.call(n,e)}De(){this.H=!1,this.B=[]}Ai(){this.B=[]}Mt(){this.$=void 0,this.H=!1,this.B=[]}},oe=class{constructor(t,e,n,s){this.u=n,this.t=s,this._(t,"server-intent"),this._(t,"put-object"),this._(t,"delete-object"),this._(t,"payload-transferred"),this._(t,"goodbye"),this._(t,"error"),this.Rt=new Lt(e,n,s)}addPayloadListener(t){this.Rt.addPayloadListener(t)}removePayloadListener(t){this.Rt.removePayloadListener(t)}_(t,e){t.addEventListener(e,async n=>{var s,r,a,o,c;if(n!=null&&n.data){(s=this.t)==null||s.debug(`Received ${e} event.  Data is ${n.data}`);try{this.Rt.processEvents([{event:e,data:JSON.parse(n.data)}])}catch(l){(r=this.t)==null||r.error(`Stream received data that was unable to be processed in "${e}" message`),(a=this.t)==null||a.debug(`Data follows: ${n.data}`),(o=this.u)==null||o.call(this,w.InvalidData,"Malformed data in EventStream.")}}else(c=this.u)==null||c.call(this,w.Unknown,"Event from EventStream missing data.")})}};function un(i){if(i){let t=Object.keys(i).find(e=>e.toLowerCase()==="x-ld-envid");if(t)return{environmentId:i[t]}}}var ze="unknown plugin";function Ct(i,t){try{return t.getMetadata().name||ze}catch(e){return i.error("Exception thrown getting metadata for plugin. Unable to get plugin name."),ze}}function hn(i,t,e){let n=[];return e.forEach(s=>{var r;try{let a=(r=s.getHooks)==null?void 0:r.call(s,t);a===void 0?i.error(`Plugin ${Ct(i,s)} returned undefined from getHooks.`):a&&a.length>0&&n.push(...a)}catch(a){i.error(`Exception thrown getting hooks for plugin ${Ct(i,s)}. Unable to get hooks.`)}}),n}function dn(i,t,e,n){n.forEach(s=>{try{s.register(e,t)}catch(r){i.error(`Exception thrown registering plugin ${Ct(i,s)}.`)}})}var x=Object.freeze({__proto__:null,ClientMessages:kt,DiagnosticsManager:Zt,ErrorKinds:an,EventFactoryBase:ae,EventProcessor:se,InputCustomEvent:xt,InputEvalEvent:W,InputIdentifyEvent:St,NullEventProcessor:re,PayloadProcessor:Lt,PayloadStreamReader:oe,initMetadataFromHeaders:un,isLegacyUser:Ye,isMultiKind:We,isSingleKind:Je,safeGetHooks:hn,safeGetName:Ct,safeRegisterPlugins:dn,shouldSample:yt});var E;(function(i){i.Initializing="INITIALIZING",i.Valid="VALID",i.Interrupted="INTERRUPTED",i.SetOffline="SET_OFFLINE",i.Closed="CLOSED"})(E||(E={}));function pn(i){return i>=200&&i<=299}var It=class extends Error{constructor(t,e){super(t),this.status=e,this.name="LaunchDarklyRequestError"}},ye=class{constructor(t,e,n,s,r){this.L=t,this.Ii=e,this.ft=n,this.Pi=s,this.Ni=r}async requestPayload(){let t;try{let e=await this.L.fetch(this.Ii,{method:this.Pi,headers:this.ft,body:this.Ni});if(pn(e.status))return await e.text();t=e.status}catch(e){throw new It(e==null?void 0:e.message)}throw new It(`Unexpected status code: ${t}`,t)}};function Ie(i,t,e,n,s,r,a,o,c,l){let h,d="GET",f=p({},r);c&&(d="REPORT",f["content-type"]="application/json",h=i);let g=c?e.pathReport(s,i):e.pathGet(s,i),m=[...a!=null?a:[]];o&&m.push({key:"withReasons",value:"true"}),l&&m.push({key:"h",value:l});let y=Xe(t,g,m);return new ye(n,y,f,d,h)}var gn={logger:u.Object,maxCachedContexts:u.numberWithMin(0),baseUri:u.String,streamUri:u.String,eventsUri:u.String,capacity:u.numberWithMin(1),diagnosticRecordingInterval:u.numberWithMin(2),flushInterval:u.numberWithMin(2),streamInitialReconnectDelay:u.numberWithMin(0),allAttributesPrivate:u.Boolean,debug:u.Boolean,diagnosticOptOut:u.Boolean,withReasons:u.Boolean,sendEvents:u.Boolean,pollInterval:u.numberWithMin(30),useReport:u.Boolean,privateAttributes:u.StringArray,applicationInfo:u.Object,wrapperName:u.String,wrapperVersion:u.String,payloadFilterKey:u.stringMatchingRegex(/^[a-zA-Z0-9](\w|\.|-)*$/),hooks:u.createTypeArray("Hook[]",{}),inspectors:u.createTypeArray("LDInspection",{})},mn=60*5,oi="https://clientsdk.launchdarkly.com",ci="https://clientstream.launchdarkly.com";function yn(i){return i instanceof z?i:ce(i)}var ve=class{constructor(t={},e={getImplementationHooks:()=>[],credentialType:"mobileKey"}){var s,r,a;this.logger=ce(),this.baseUri=oi,this.eventsUri=M.DEFAULT_EVENTS,this.streamUri=ci,this.maxCachedContexts=5,this.capacity=100,this.diagnosticRecordingInterval=900,this.flushInterval=30,this.streamInitialReconnectDelay=1,this.allAttributesPrivate=!1,this.debug=!1,this.diagnosticOptOut=!1,this.sendEvents=!0,this.sendLDHeaders=!0,this.useReport=!1,this.withReasons=!1,this.privateAttributes=[],this.pollInterval=mn,this.hooks=[],this.inspectors=[],this.logger=yn(t.logger),this.Oi(t).forEach(o=>this.logger.warn(o)),this.serviceEndpoints=new M(this.streamUri,this.baseUri,this.eventsUri,e.analyticsEventPath,e.diagnosticEventPath,e.includeAuthorizationHeader,t.payloadFilterKey),this.useReport=(s=t.useReport)!=null?s:!1,this.tags=new Dt({application:this.applicationInfo,logger:this.logger}),this.userAgentHeaderName=(r=e.userAgentHeaderName)!=null?r:"user-agent",this.trackEventModifier=(a=e.trackEventModifier)!=null?a:o=>o,this.credentialType=e.credentialType,this.getImplementationHooks=e.getImplementationHooks}Oi(t){let e=[];return Object.entries(t).forEach(([n,s])=>{let r=gn[n];if(r)if(r.is(s))n==="logger"||(this[n]=s!=null?s:void 0);else{let a=r.getType();if(a==="boolean")e.push(b.wrongOptionTypeBoolean(n,typeof s)),this[n]=!!s;else if(a==="boolean | undefined | null")e.push(b.wrongOptionTypeBoolean(n,typeof s)),typeof s!="boolean"&&typeof s!="undefined"&&s!==null&&(this[n]=!!s);else if(r instanceof G&&u.Number.is(s)){let{min:o}=r;e.push(b.optionBelowMinimum(n,s,o)),this[n]=o}else e.push(b.wrongOptionType(n,r.getType(),typeof s))}else e.push(b.unknownOption(n))}),e}};async function li(i,t){if(i.digest)return i.digest(t);if(i.asyncDigest)return i.asyncDigest(t);throw new Error("Platform must implement digest or asyncDigest")}var ui=async(i,{crypto:t,storage:e})=>{let n=await(e==null?void 0:e.get(i));return n||(n=t.randomUUID(),await(e==null?void 0:e.set(i,n))),n};function hi(i){return async t=>li(i.createHash("sha256").update(t),"base64")}var S=async i=>i;async function X(i){return(await Promise.all(i.map(e=>e.transform(e.value)))).join("_")}async function vn(i,t){return X([{value:"LaunchDarkly",transform:S},{value:t,transform:hi(i)}])}async function wn(i){return X([{value:"LaunchDarkly",transform:S},{value:"AnonymousKeys",transform:S},{value:i,transform:S}])}async function En(i){return X([{value:"LaunchDarkly",transform:S},{value:"ContextKeys",transform:S},{value:i,transform:S}])}async function Dn(i){return X([{value:i,transform:S},{value:"ContextIndex",transform:S}])}async function ni(i,t,e){return X([{value:t,transform:S},{value:e.canonicalKey,transform:hi(i)}])}var{isLegacyUser:bn,isSingleKind:fe,isMultiKind:si}=x,di="1.0",kn=i=>{let n=i,{kind:t}=n,e=jt(n,["kind"]);return{kind:"multi",[t]:e}},xn=async({crypto:i,info:t},{applicationInfo:e})=>{var a;let{ld_application:n}=t.platformData(),s=(a=At(n))!=null?a:{},r=(e==null?void 0:e.id)||(s==null?void 0:s.id);if(r){let o=(e==null?void 0:e.version)||(s==null?void 0:s.version),c=(e==null?void 0:e.name)||(s==null?void 0:s.name),l=(e==null?void 0:e.versionName)||(s==null?void 0:s.versionName);return s=p(p(p(D(p({},s),{id:r}),o?{version:o}:{}),c?{name:c}:{}),l?{versionName:l}:{}),s.key=await li(i.createHash("sha256").update(r),"base64"),s.envAttributesVersion=s.envAttributesVersion||di,s}},Sn=async i=>{var o,c,l,h;let{ld_device:t,os:e}=i.info.platformData(),n=(o=At(t))!=null?o:{},s=(e==null?void 0:e.name)||((c=n.os)==null?void 0:c.name),r=(e==null?void 0:e.version)||((l=n.os)==null?void 0:l.version),a=(h=n.os)==null?void 0:h.family;if((s||r||a)&&(n.os=p(p(p({},s?{name:s}:{}),r?{version:r}:{}),a?{family:a}:{})),Object.keys(n).filter(d=>d!=="key"&&d!=="envAttributesVersion").length){let d=await En("ld_device");return n.key=await ui(d,i),n.envAttributesVersion=n.envAttributesVersion||di,n}},Ln=async(i,t,e)=>{if(bn(i))return i;let n,s;if(fe(i)&&i.kind!=="ld_application"||si(i)&&!i.ld_application?n=await xn(t,e):e.logger.warn("Not adding ld_application environment attributes because it already exists."),fe(i)&&i.kind!=="ld_device"||si(i)&&!i.ld_device?s=await Sn(t):e.logger.warn("Not adding ld_device environment attributes because it already exists."),n||s){let r=fe(i)?kn(i):i;return p(p(p({},r),n?{ld_application:n}:{}),s?{ld_device:s}:{})}return i},{isLegacyUser:Cn,isMultiKind:Tn,isSingleKind:An}=x,Pe=async(i,t,e)=>{let{anonymous:n,key:s}=t;if(n&&!s){let r=await wn(i);t.key=await ui(r,e)}},In=async(i,t)=>{await Pe(i.kind,i,t)},Pn=async(i,t)=>{let s=i,{kind:e}=s,n=jt(s,["kind"]);return Promise.all(Object.entries(n).map(([r,a])=>Pe(r,a,t)))},Nn=async(i,t)=>{await Pe("user",i,t)},On=async(i,t)=>{let e=he(i);return An(e)&&await In(e,t),Tn(e)&&await Pn(e,t),Cn(e)&&await Nn(e,t),e},$n=i=>({customBaseURI:i.serviceEndpoints.polling!==oi,customStreamURI:i.serviceEndpoints.streaming!==ci,customEventsURI:i.serviceEndpoints.events!==M.DEFAULT_EVENTS,eventsCapacity:i.capacity,eventsFlushIntervalMillis:Tt(i.flushInterval),reconnectTimeMillis:Tt(i.streamInitialReconnectDelay),diagnosticRecordingIntervalMillis:Tt(i.diagnosticRecordingInterval),allAttributesPrivate:i.allAttributesPrivate,usingSecureMode:!1,bootstrapMode:!1}),Mn=(i,t,e)=>{if(t.sendEvents&&!t.diagnosticOptOut)return new x.DiagnosticsManager(i,e,$n(t))};function pe(i,t){return{value:t!=null?t:null,variationIndex:null,reason:{kind:"ERROR",errorKind:i}}}function ri(i,t,e){return{value:i,variationIndex:t!=null?t:null,reason:e!=null?e:null}}var Rn=(i,t,e,n,s)=>{if(t.sendEvents)return new x.EventProcessor(D(p({},t),{eventsCapacity:t.capacity}),new bt(i,t,e),n,void 0,s,!1)},Pt=class extends x.EventFactoryBase{evalEventClient(t,e,n,s,r,a){let{trackEvents:o,debugEventsUntilDate:c,trackReason:l,flagVersion:h,version:d,variation:f}=s;return super.evalEvent({addExperimentData:l,context:r,debugEventsUntilDate:c,defaultVal:n,flagKey:t,reason:a,trackEvents:!!o,value:e,variation:f,version:h!=null?h:d})}},Z=class i{constructor(){this.container={index:new Array}}static fromJson(t){let e=new i;try{e.container=JSON.parse(t)}catch(n){}return e}toJson(){return JSON.stringify(this.container)}notice(t,e){let n=this.container.index.find(s=>s.id===t);n===void 0?this.container.index.push({id:t,timestamp:e}):n.timestamp=e}prune(t){let e=Math.max(t,0);return this.container.index.length>e?(this.container.index.sort((n,s)=>n.timestamp-s.timestamp),this.container.index.splice(0,this.container.index.length-e)):[]}},we=class{constructor(t,e,n,s,r,a,o=()=>Date.now()){this.l=t,this.Ft=e,this.$i=n,this.m=s,this.C=r,this.t=a,this.pt=o,this.be=Dn(this.Ft)}async init(t,e){this.C.init(t,e),await this.ke(t)}async upsert(t,e,n){return this.C.upsert(t,e,n)?(await this.ke(t),!0):!1}async loadCached(t){var s,r,a,o;let e=await ni(this.l.crypto,this.Ft,t),n=await((s=this.l.storage)==null?void 0:s.get(e));if(n==null){if(n=await((r=this.l.storage)==null?void 0:r.get(t.canonicalKey)),n==null)return!1;await((a=this.l.storage)==null?void 0:a.set(e,n)),await((o=this.l.storage)==null?void 0:o.clear(t.canonicalKey))}try{let c=JSON.parse(n),l=Object.entries(c).reduce((h,[d,f])=>(h[d]={version:f.version,flag:f},h),{});return this.C.initCached(t,l),this.t.debug("Loaded cached flag evaluations from persistent storage"),!0}catch(c){return this.t.warn(`Could not load cached flag evaluations from persistent storage: ${c.message}`),!1}}async Mi(){var e;if(this.K!==void 0)return this.K;let t=await((e=this.l.storage)==null?void 0:e.get(await this.be));if(!t)return this.K=new Z,this.K;try{this.K=Z.fromJson(t),this.t.debug("Loaded context index from persistent storage")}catch(n){this.t.warn(`Could not load index from persistent storage: ${n.message}`),this.K=new Z}return this.K}async ke(t){var c,l;let e=await this.Mi(),n=await ni(this.l.crypto,this.Ft,t);e.notice(n,this.pt());let s=e.prune(this.$i);await Promise.all(s.map(async h=>{var d;return(d=this.l.storage)==null?void 0:d.clear(h.id)})),await((c=this.l.storage)==null?void 0:c.set(await this.be,e.toJson()));let r=this.m.getAll(),a=Object.entries(r).reduce((h,[d,f])=>(f.flag!==null&&f.flag!==void 0&&(h[d]=f.flag),h),{}),o=JSON.stringify(a);await((l=this.l.storage)==null?void 0:l.set(n,o))}},Ee=class{constructor(){this.X={}}init(t){this.X=Object.entries(t).reduce((e,[n,s])=>(e[n]=s,e),{})}insertOrUpdate(t,e){this.X[t]=e}get(t){if(Object.prototype.hasOwnProperty.call(this.X,t))return this.X[t]}getAll(){return this.X}};function Fn(i,t){let e=[];return Object.entries(i).forEach(([n,s])=>{let r=t[n];(!r||!K(s,r))&&e.push(n)}),Object.keys(t).forEach(n=>{i[n]||e.push(n)}),e}var De=class{constructor(t,e){this.Q=new Array,this.m=t,this.t=e}init(t,e){this.xe=t.canonicalKey;let n=this.m.getAll();this.m.init(e);let s=Fn(n,e);s.length>0&&this.Q.forEach(r=>{try{r(t,s,"init")}catch(a){}})}initCached(t,e){this.xe!==t.canonicalKey&&this.init(t,e)}upsert(t,e,n){if(this.xe!==t.canonicalKey)return this.t.warn("Received an update for an inactive context."),!1;let s=this.m.get(e);return s!==void 0&&s.version>=n.version?!1:(this.m.insertOrUpdate(e,n),this.Q.forEach(r=>{try{r(t,[e],"patch")}catch(a){}}),!0)}on(t){this.Q.push(t)}off(t){let e=this.Q.indexOf(t);e>-1&&this.Q.splice(e,1)}},be=class{constructor(t,e,n,s,r=()=>Date.now()){this.m=new Ee,this.C=new De(this.m,s),this.Ut=this.Ri(t,e,n,s,r)}async Ri(t,e,n,s,r=()=>Date.now()){let a=await vn(t.crypto,e);return new we(t,a,n,this.m,this.C,s,r)}get(t){return this.m.get(t)}getAll(){return this.m.getAll()}setBootstrap(t,e){this.C.init(t,e)}async init(t,e){return(await this.Ut).init(t,e)}async upsert(t,e,n){return(await this.Ut).upsert(t,e,n)}async loadCached(t){return(await this.Ut).loadCached(t)}on(t){this.C.on(t)}off(t){this.C.off(t)}},ai="unknown hook",fi="beforeEvaluation",pi="afterEvaluation",Un="afterTrack";function Q(i,t,e,n,s){try{return n()}catch(r){return i==null||i.error(`An error was encountered in "${t}" of the "${e}" hook: ${r}`),s}}function tt(i,t){try{return t.getMetadata().name||ai}catch(e){return i.error("Exception thrown getting metadata for hook. Unable to get hook name."),ai}}function Vn(i,t,e){return t.map(n=>Q(i,fi,tt(i,n),()=>{var s,r;return(r=(s=n==null?void 0:n.beforeEvaluation)==null?void 0:s.call(n,e,{}))!=null?r:{}},{}))}function jn(i,t,e,n,s){for(let r=t.length-1;r>=0;r-=1){let a=t[r],o=n[r];Q(i,pi,tt(i,a),()=>{var c,l;return(l=(c=a==null?void 0:a.afterEvaluation)==null?void 0:c.call(a,e,o,s))!=null?l:{}},{})}}function Hn(i,t,e){return t.map(n=>Q(i,fi,tt(i,n),()=>{var s,r;return(r=(s=n==null?void 0:n.beforeIdentify)==null?void 0:s.call(n,e,{}))!=null?r:{}},{}))}function Bn(i,t,e,n,s){for(let r=t.length-1;r>=0;r-=1){let a=t[r],o=n[r];Q(i,pi,tt(i,a),()=>{var c,l;return(l=(c=a==null?void 0:a.afterIdentify)==null?void 0:c.call(a,e,o,s))!=null?l:{}},{})}}function _n(i,t,e){for(let n=t.length-1;n>=0;n-=1){let s=t[n];Q(i,Un,tt(i,s),()=>{var r;return(r=s==null?void 0:s.afterTrack)==null?void 0:r.call(s,e)},void 0)}}var ke=class{constructor(t,e){this.t=t,this.M=[],this.M.push(...e)}withEvaluation(t,e,n,s){if(this.M.length===0)return s();let r=[...this.M],a={flagKey:t,context:e,defaultValue:n},o=Vn(this.t,r,a),c=s();return jn(this.t,r,a,o,c),c}identify(t,e){let n=[...this.M],s={context:t,timeout:e},r=Hn(this.t,n,s);return a=>{Bn(this.t,n,s,r,a)}}addHook(t){this.M.push(t)}afterTrack(t){if(this.M.length===0)return;let e=[...this.M];_n(this.t,e,t)}};function Kn(i){return{getMetadata(){return{name:"LaunchDarkly-Inspector-Adapter"}},afterEvaluation:(t,e,n)=>(i.onFlagUsed(t.flagKey,n,t.context),e),afterIdentify(t,e,n){return i.onIdentityChanged(t.context),e}}}function Gn(i,t){return`an inspector: "${t}" of an invalid type (${i}) was configured`}function zn(i,t){return`an inspector: "${t}" of type: "${i}" generated an exception`}function qn(i,t){let e=!1,n={method:(...s)=>{try{i.method(...s)}catch(r){e||(e=!0,t.warn(zn(n.type,n.name)))}},type:i.type,name:i.name,synchronous:i.synchronous};return n}var gi="flag-used",mi="flag-details-changed",yi="flag-detail-changed",vi="client-identity-changed",Jn=[gi,mi,yi,vi];function Wn(i,t){let e=Jn.includes(i.type)&&i.method&&typeof i.method=="function";return e||t.warn(Gn(i.type,i.name)),e}var xe=class{constructor(t,e){this.G=[];let n=t.filter(s=>Wn(s,e));this.G=n.map(s=>qn(s,e))}hasInspectors(){return this.G.length!==0}onFlagUsed(t,e,n){this.G.forEach(s=>{s.type===gi&&s.method(t,e,n)})}onFlagsChanged(t){this.G.forEach(e=>{e.type===mi&&e.method(t)})}onFlagChanged(t,e){this.G.forEach(n=>{n.type===yi&&n.method(t,e)})}onIdentityChanged(t){this.G.forEach(e=>{e.type===vi&&e.method(t)})}},Se=class{constructor(t){this.t=t,this.e=new Map}on(t,e){var n;this.e.has(t)?(n=this.e.get(t))==null||n.push(e):this.e.set(t,[e])}off(t,e){let n=this.e.get(t);if(n){if(e){let s=n.filter(r=>r!==e);s.length===0?this.e.delete(t):this.e.set(t,s);return}this.e.delete(t)}}Vt(t,e,...n){var s;try{t(...n)}catch(r){(s=this.t)==null||s.error(`Encountered error invoking handler for "${e}", detail: "${r}"`)}}emit(t,...e){let n=this.e.get(t);n==null||n.forEach(s=>this.Vt(s,t,...e))}eventNames(){return[...this.e.keys()]}listenerCount(t){var e,n;return(n=(e=this.e.get(t))==null?void 0:e.length)!=null?n:0}};function Yn(i,t,e){let n=t.info.sdkData(),s;e.applicationInfo&&(e.applicationInfo.id&&(s=s!=null?s:{},s.id=e.applicationInfo.id),e.applicationInfo.version&&(s=s!=null?s:{},s.version=e.applicationInfo.version),e.applicationInfo.name&&(s=s!=null?s:{},s.name=e.applicationInfo.name),e.applicationInfo.versionName&&(s=s!=null?s:{},s.versionName=e.applicationInfo.versionName));let r={name:n.userAgentBase,version:n.version};n.wrapperName&&(r.wrapperName=n.wrapperName),n.wrapperVersion&&(r.wrapperVersion=n.wrapperVersion);let a={sdk:r,[e.credentialType]:i};return s&&(a.application=s),a}var{ClientMessages:ge,ErrorKinds:me}=x,Zn=5,Nt=class{constructor(t,e,n,s,r,a){if(this.sdkKey=t,this.autoEnvAttributes=e,this.platform=n,this.jt=15,this.T=new Pt(!1),this.gt=new Pt(!0),this.Ht=!1,!t)throw new Error("You must configure the client with a client-side SDK key");if(!n.encoding)throw new Error("Platform must implement Encoding because btoa is required.");this.r=new ve(s,a),this.logger=this.r.logger,this.Se=ti(this.sdkKey,this.platform.info,this.r.tags,this.r.serviceEndpoints.includeAuthorizationHeader,this.r.userAgentHeaderName),this.b=new be(this.platform,t,this.r.maxCachedContexts,this.r.logger),this.D=Mn(t,this.r,n),this.y=Rn(t,this.r,n,this.Se,this.D),this.emitter=new Se,this.emitter.on("error",(c,l)=>{this.logger.error(`error: ${l}, context: ${JSON.stringify(c)}`)}),this.b.on((c,l,h)=>{this.Fi(l,h);let d=k.toLDContext(c);this.emitter.emit("change",d,l),l.forEach(f=>{this.emitter.emit(`change:${f}`,d)})}),this.dataManager=r(this.b,this.r,this.Se,this.emitter,this.D);let o=[...this.r.hooks];this.environmentMetadata=Yn(this.sdkKey,this.platform,this.r),this.r.getImplementationHooks(this.environmentMetadata).forEach(c=>{o.push(c)}),this.R=new ke(this.logger,o),this.tt=new xe(this.r.inspectors,this.logger),this.tt.hasInspectors()&&this.R.addHook(Kn(this.tt))}allFlags(){return Object.entries(this.b.getAll()).reduce((e,[n,s])=>(s.flag!==null&&s.flag!==void 0&&!s.flag.deleted&&(e[n]=s.flag.value),e),{})}async close(){var t;await this.flush(),(t=this.y)==null||t.close(),this.dataManager.close(),this.logger.debug("Closed event processor and data source.")}async flush(){var t;try{await((t=this.y)==null?void 0:t.flush()),this.logger.debug("Successfully flushed event processor.")}catch(e){return this.logger.error(`Error flushing event processor: ${e}.`),{error:e,result:!1}}return{result:!0}}getContext(){return this.v?he(this.v):void 0}getInternalContext(){return this.z}Ui(t,e){let n,s,r=new Promise((c,l)=>{n=c,s=l});if(e)return{identifyPromise:r,identifyResolve:n,identifyReject:s};let a=ii(t,"identify");return{identifyPromise:Promise.race([a,r]).catch(c=>{throw c.message.includes("timed out")&&this.logger.error(`identify error: ${c}`),c}),identifyResolve:n,identifyReject:s}}async identify(t,e){var d,f;let n=(d=e==null?void 0:e.timeout)!=null?d:Zn,s=(e==null?void 0:e.timeout)===void 0&&(e==null?void 0:e.noTimeout)===!0;n>this.jt&&this.logger.warn(`The identify function was called with a timeout greater than ${this.jt} seconds. We recommend a timeout of less than ${this.jt} seconds.`);let r=await On(t,this.platform);this.autoEnvAttributes===V.Enabled&&(r=await Ln(r,this.platform,this.r));let a=k.fromLDContext(r);if(!a.valid){let g=new Error("Context was unspecified or had no key");return this.emitter.emit("error",r,g),Promise.reject(g)}this.v=r,this.z=a,(f=this.y)==null||f.sendEvent(this.T.identifyEvent(this.z));let{identifyPromise:o,identifyResolve:c,identifyReject:l}=this.Ui(n,s);this.logger.debug(`Identifying ${JSON.stringify(this.z)}`);let h=this.R.identify(r,e==null?void 0:e.timeout);return await this.dataManager.identify(c,l,a,e),o.then(g=>(h({status:"completed"}),g),g=>{throw h({status:"error"}),g})}on(t,e){this.emitter.on(t,e)}off(t,e){this.emitter.off(t,e)}track(t,e,n){var s,r;if(!this.z||!this.z.valid){this.logger.warn(ge.MissingContextKeyNoEvent);return}n!==void 0&&!u.Number.is(n)&&((s=this.logger)==null||s.warn(ge.invalidMetricValue(typeof n))),(r=this.y)==null||r.sendEvent(this.r.trackEventModifier(this.T.customEvent(t,this.z,e,n))),this.R.afterTrack({key:t,context:this.v,data:e,metricValue:n})}mt(t,e,n,s){var f,g,m;if(!this.v)return this.logger.debug(ge.MissingContextKeyNoEvent),pe(me.UserNotSpecified,e);let r=k.fromLDContext(this.v),a=this.b.get(t);if(a===void 0||a.flag.deleted){let y=e!=null?e:null,L=new J(`Unknown feature flag "${t}"; returning default value ${y}.`);return this.emitter.emit("error",this.v,L),(f=this.y)==null||f.sendEvent(this.T.unknownFlagEvent(t,y,r)),pe(me.FlagNotFound,e)}let{reason:o,value:c,variation:l,prerequisites:h}=a.flag;if(s){let[y,L]=s(c);if(!y){(g=this.y)==null||g.sendEvent(n.evalEventClient(t,e,e,a.flag,r,o));let R=new J(`Wrong type "${L}" for feature flag "${t}"; returning default value`);return this.emitter.emit("error",this.v,R),pe(me.WrongType,e)}}let d=ri(c,l,o);return c==null&&(this.logger.debug("Result value is null. Providing default value."),d.value=e),h==null||h.forEach(y=>{this.mt(y,void 0,this.T)}),(m=this.y)==null||m.sendEvent(n.evalEventClient(t,c,e,a.flag,r,o)),d}variation(t,e){let{value:n}=this.R.withEvaluation(t,this.v,e,()=>this.mt(t,e,this.T));return n}variationDetail(t,e){return this.R.withEvaluation(t,this.v,e,()=>this.mt(t,e,this.gt))}q(t,e,n,s){return this.R.withEvaluation(t,this.v,e,()=>this.mt(t,e,n,s))}boolVariation(t,e){return this.q(t,e,this.T,n=>[u.Boolean.is(n),u.Boolean.getType()]).value}jsonVariation(t,e){return this.variation(t,e)}numberVariation(t,e){return this.q(t,e,this.T,n=>[u.Number.is(n),u.Number.getType()]).value}stringVariation(t,e){return this.q(t,e,this.T,n=>[u.String.is(n),u.String.getType()]).value}boolVariationDetail(t,e){return this.q(t,e,this.gt,n=>[u.Boolean.is(n),u.Boolean.getType()])}numberVariationDetail(t,e){return this.q(t,e,this.gt,n=>[u.Number.is(n),u.Number.getType()])}stringVariationDetail(t,e){return this.q(t,e,this.gt,n=>[u.String.is(n),u.String.getType()])}jsonVariationDetail(t,e){return this.variationDetail(t,e)}addHook(t){this.R.addHook(t)}setEventSendingEnabled(t,e){var n,s,r,a;this.Ht!==t&&(this.Ht=t,t?(this.logger.debug("Starting event processor"),(n=this.y)==null||n.start()):e?((s=this.logger)==null||s.debug("Flushing event processor before disabling."),this.flush().then(()=>{var o,c;this.Ht||((o=this.logger)==null||o.debug("Stopping event processor."),(c=this.y)==null||c.close())})):((r=this.logger)==null||r.debug("Stopping event processor."),(a=this.y)==null||a.close()))}sendEvent(t){var e;(e=this.y)==null||e.sendEvent(t)}Fi(t,e){if(!this.tt.hasInspectors())return;let n={};t.forEach(s=>{let r=this.b.get(s);if(r!=null&&r.flag&&!r.flag.deleted){let{reason:a,value:o,variation:c}=r.flag;n[s]=ri(o,c,a)}else n[s]={value:void 0,reason:null,variationIndex:null}}),e==="init"?this.tt.onFlagsChanged(n):e==="patch"&&Object.entries(n).forEach(([s,r])=>{this.tt.onFlagChanged(s,r)})}},Le=class{constructor(t,e,n){this.b=t,this.Bt=e,this.t=n}async handlePut(t,e){this.t.debug(`Got PUT: ${Object.keys(e)}`);let n=Object.entries(e).reduce((s,[r,a])=>(s[r]={version:a.version,flag:a},s),{});await this.b.init(t,n),this.Bt.requestStateUpdate(E.Valid)}async handlePatch(t,e){this.t.debug(`Got PATCH ${JSON.stringify(e,null,2)}`),this.b.upsert(t,e.key,{version:e.version,flag:e})}async handleDelete(t,e){this.t.debug(`Got DELETE ${JSON.stringify(e,null,2)}`),this.b.upsert(t,e.key,{version:e.version,flag:D(p({},e),{deleted:!0,flagVersion:0,value:void 0,variation:0,trackEvents:!1})})}handleStreamingError(t){this.Bt.reportError(t.kind,t.message,t.code,t.recoverable)}handlePollingError(t){this.Bt.reportError(t.kind,t.message,t.status,t.recoverable)}},Ce=class{constructor(t,e=()=>Date.now()){this.A=t,this.yt=E.Closed,this.Le=e(),this.pt=e}get status(){return{state:this.yt,stateSince:this.Le,lastError:this.Vi}}Ce(t,e=!1){let n=t===E.Interrupted&&this.yt===E.Initializing?E.Initializing:t,s=this.yt!==n;s&&(this.yt=n,this.Le=this.pt()),(s||e)&&this.A.emit("dataSourceStatus",this.status)}requestStateUpdate(t){this.Ce(t)}reportError(t,e,n,s=!1){let r={kind:t,message:e,statusCode:n,time:this.pt()};this.Vi=r,this.Ce(s?E.Interrupted:E.Closed,!0)}},Te=class{constructor(t,e,n,s,r){this.ji=t,this.Hi=e,this.Bi=n,this.u=s,this.t=r,this.F=!1}async Te(){var r,a,o,c,l,h,d;if(this.F)return;let t=f=>{var g,m,y;(g=this.t)==null||g.error("Polling received invalid data"),(m=this.t)==null||m.debug(`Invalid JSON follows: ${f}`),(y=this.u)==null||y.call(this,new O(w.InvalidData,"Malformed JSON data in polling response"))};(r=this.t)==null||r.debug("Polling LaunchDarkly for feature flag updates");let e=Date.now();try{let f=await this.ji.requestPayload();try{let g=JSON.parse(f);try{(a=this.Bi)==null||a.call(this,g)}catch(m){(o=this.t)==null||o.error(`Exception from data handler: ${m}`)}}catch(g){t(f)}}catch(f){let g=f;if(g.status!==void 0&&!Y(g.status)){(c=this.t)==null||c.error(B(f,"polling request")),(l=this.u)==null||l.call(this,new O(w.ErrorResponse,g.message,g.status));return}(h=this.t)==null||h.error(B(f,"polling request","will retry"))}let n=Date.now()-e,s=Math.max(this.Hi*1e3-n,0);(d=this.t)==null||d.debug("Elapsed: %d ms, sleeping for %d ms",n,s),this._t=setTimeout(()=>{this.Te()},s)}start(){this.Te()}stop(){this._t&&(clearTimeout(this._t),this._t=void 0),this.F=!0}close(){this.stop()}},Xn=(i,t,e,n)=>{e==null||e.error(`Stream received invalid data in "${i}" message`),e==null||e.debug(`Invalid JSON follows: ${t}`),n==null||n(new U(w.InvalidData,"Malformed JSON data in event stream"))},Ae=class{constructor(t,e,n,s,r,a,o,c,l){var f;this._i=t,this.Kt=e,this.e=n,this.L=s,this.Ki=a,this.D=o,this.u=c,this.t=l;let h;e.useReport&&!s.getEventSourceCapabilities().customMethod?h=e.paths.pathPing(r,t):h=e.useReport?e.paths.pathReport(r,t):e.paths.pathGet(r,t);let d=[...(f=e.queryParameters)!=null?f:[]];this.Kt.withReasons&&d.push({key:"withReasons",value:"true"}),this.L=s,this.ft=p({},e.baseHeaders),this.t=l,this.Gi=Ze(e.serviceEndpoints,h,d)}Ae(){this.vt=Date.now()}Gt(t){this.vt&&this.D&&this.D.recordStreamInit(this.vt,!t,Date.now()-this.vt),this.vt=void 0}zi(t){var e,n,s;return ei(t)?((s=this.t)==null||s.warn(B(t,"streaming request","will retry")),this.Gt(!1),this.Ae(),!0):(this.Gt(!1),(e=this.u)==null||e.call(this,new U(w.ErrorResponse,t.message,t.status,!1)),(n=this.t)==null||n.error(B(t,"streaming request")),!1)}start(){this.Ae();let t;this.Kt.useReport?(this.ft["content-type"]="application/json",t={method:"REPORT",body:this._i}):t={};let e=this.L.createEventSource(this.Gi,D(p({headers:this.ft},t),{errorFilter:n=>this.zi(n),initialRetryDelayMillis:this.Kt.initialRetryDelayMillis,readTimeoutMillis:5*60*1e3,retryResetIntervalMillis:60*1e3}));this.Ie=e,e.onclose=()=>{var n;(n=this.t)==null||n.info("Closed LaunchDarkly stream connection")},e.onerror=()=>{},e.onopen=()=>{var n;(n=this.t)==null||n.info("Opened LaunchDarkly stream connection")},e.onretrying=n=>{var s;(s=this.t)==null||s.info(`Will retry stream connection in ${n.delayMillis} milliseconds`)},this.e.forEach(({deserializeData:n,processJson:s},r)=>{e.addEventListener(r,a=>{var o,c;if((o=this.t)==null||o.debug(`Received ${r} event`),a!=null&&a.data){this.Gt(!0);let{data:l}=a,h=n(l);if(!h){Xn(r,l,this.t,this.u);return}s(h)}else(c=this.u)==null||c.call(this,new U(w.InvalidData,"Unexpected payload from event stream"))})}),e.addEventListener("ping",async()=>{var n,s,r,a,o,c,l;(n=this.t)==null||n.debug("Got PING, going to poll LaunchDarkly for feature flag updates");try{let h=await this.Ki.requestPayload();try{let d=JSON.parse(h);try{(s=this.e.get("put"))==null||s.processJson(d)}catch(f){(r=this.t)==null||r.error(`Exception from data handler: ${f}`)}}catch(d){(a=this.t)==null||a.error("Polling after ping received invalid data"),(o=this.t)==null||o.debug(`Invalid JSON follows: ${h}`),(c=this.u)==null||c.call(this,new O(w.InvalidData,"Malformed JSON data in ping polling response"))}}catch(h){let d=h;(l=this.u)==null||l.call(this,new O(w.ErrorResponse,d.message,d.status))}})}stop(){var t;(t=this.Ie)==null||t.close(),this.Ie=void 0}close(){this.stop()}},Ot=class{constructor(t,e,n,s,r,a,o,c,l){this.platform=t,this.flagManager=e,this.credential=n,this.config=s,this.getPollingPaths=r,this.getStreamingPaths=a,this.baseHeaders=o,this.emitter=c,this.diagnosticsManager=l,this.closed=!1,this.logger=s.logger,this.dataSourceStatusManager=new Ce(c),this.J=new Le(e,this.dataSourceStatusManager,this.config.logger)}setConnectionParams(t){this.qi=t}createPollingProcessor(t,e,n,s,r){let a=new Te(n,this.config.pollInterval,async o=>{await this.J.handlePut(e,o),s==null||s()},o=>{this.emitter.emit("error",t,o),this.J.handlePollingError(o),r==null||r(o)},this.logger);this.updateProcessor=this.Pe(a,this.dataSourceStatusManager)}createStreamingProcessor(t,e,n,s,r){var o;let a=new Ae(JSON.stringify(t),{credential:this.credential,serviceEndpoints:this.config.serviceEndpoints,paths:this.getStreamingPaths(),baseHeaders:this.baseHeaders,initialRetryDelayMillis:this.config.streamInitialReconnectDelay*1e3,withReasons:this.config.withReasons,useReport:this.config.useReport,queryParameters:(o=this.qi)==null?void 0:o.queryParameters},this.createStreamListeners(e,s),this.platform.requests,this.platform.encoding,n,this.diagnosticsManager,c=>{this.emitter.emit("error",t,c),this.J.handleStreamingError(c),r==null||r(c)},this.logger);this.updateProcessor=this.Pe(a,this.dataSourceStatusManager)}createStreamListeners(t,e){let n=new Map;return n.set("put",{deserializeData:JSON.parse,processJson:async s=>{await this.J.handlePut(t,s),e==null||e()}}),n.set("patch",{deserializeData:JSON.parse,processJson:async s=>{this.J.handlePatch(t,s)}}),n.set("delete",{deserializeData:JSON.parse,processJson:async s=>{this.J.handleDelete(t,s)}}),n}Pe(t,e){return{start:()=>{e.requestStateUpdate(E.Initializing),t.start()},stop:()=>{t.stop(),e.requestStateUpdate(E.Closed)},close:()=>{t.close(),e.requestStateUpdate(E.Closed)}}}close(){var t;(t=this.updateProcessor)==null||t.close(),this.closed=!0}};function $t(){return typeof document!==void 0}function Ne(){return typeof window!==void 0}function Mt(i,t,e){return $t()?(document.addEventListener(i,t,e),()=>{document.removeEventListener(i,t,e)}):()=>{}}function Rt(i,t,e){return $t()?(window.addEventListener(i,t,e),()=>{window.removeEventListener(i,t,e)}):()=>{}}function C(){return Ne()?window.location.href:""}function wi(){return Ne()?window.location.search:""}function Ei(){return Ne()?window.location.hash:""}function Di(){if(typeof crypto!==void 0)return crypto;throw Error("Access to a web crypto API is required")}function bi(){return $t()?document.visibilityState:"visibile"}function ki(i){if($t())return document.querySelectorAll(i)}function xi(i,t){let e=Object.keys(t),n="$flagsState",s="$valid",r=t[n];!r&&e.length&&i.warn("LaunchDarkly client was initialized with bootstrap data that did not include flag metadata. Events may not be sent correctly."),t[s]===!1&&i.warn("LaunchDarkly bootstrap data is not available because the back end could not read the flags.");let a={};return e.forEach(o=>{if(o!==n&&o!==s){let c;r&&r[o]?c=p({value:t[o]},r[o]):c={value:t[o],version:0},a[o]={version:c.version,flag:c}}}),a}var Qn="[BrowserDataManager]",et=class extends Ot{constructor(e,n,s,r,a,o,c,l,h,d){super(e,n,s,r,o,c,l,h,d);this.cn=a;this.et=void 0;this.zt=!1;this.et=a.streaming}I(e,...n){this.logger.debug(`${Qn} ${e}`,...n)}async identify(e,n,s,r){if(this.closed){this.I("Identify called after data manager was closed.");return}this.context=s;let a=r;a!=null&&a.hash?this.setConnectionParams({queryParameters:[{key:"h",value:a.hash}]}):this.setConnectionParams(),this.qt=a==null?void 0:a.hash,a!=null&&a.bootstrap?this.Ji(s,a.bootstrap,e):(await this.flagManager.loadCached(s)&&this.I("Identify - Flags loaded from cache. Continuing to initialize via a poll."),await this.Wi(s,e,n)),this.Jt()}async Wi(e,n,s){var r,a;try{this.dataSourceStatusManager.requestStateUpdate(E.Initializing);let o=JSON.stringify(k.toLDContext(e)),l=await Ie(o,this.config.serviceEndpoints,this.getPollingPaths(),this.platform.requests,this.platform.encoding,this.baseHeaders,[],this.config.withReasons,this.config.useReport,this.qt).requestPayload();try{let d=this.createStreamListeners(e,n).get("put");d.processJson(d.deserializeData(l))}catch(h){this.dataSourceStatusManager.reportError(w.InvalidData,(r=h.message)!=null?r:"Could not parse poll response")}}catch(o){this.dataSourceStatusManager.reportError(w.NetworkError,(a=o.message)!=null?a:"unexpected network error",o.status),s(o)}}Ji(e,n,s){this.flagManager.setBootstrap(e,xi(this.logger,n)),this.I("Identify - Initialization completed from bootstrap"),s()}setForcedStreaming(e){this.et=e,this.Jt()}setAutomaticStreamingState(e){this.zt=e,this.Jt()}Jt(){let e=this.et||this.zt&&this.et===void 0;this.I(`Updating streaming state. forced(${this.et}) automatic(${this.zt})`),e?this.Yi():this.Zi()}Zi(){var e;this.updateProcessor&&this.I("Stopping update processor."),(e=this.updateProcessor)==null||e.close(),this.updateProcessor=void 0}Yi(){if(this.updateProcessor){this.I("Update processor already active. Not changing state.");return}if(!this.context){this.I("Context not set, not starting update processor.");return}this.I("Starting update processor."),this.Xi(this.context)}Xi(e,n,s){var c;let r=k.toLDContext(e);(c=this.updateProcessor)==null||c.close();let a=JSON.stringify(k.toLDContext(e)),o=Ie(a,this.config.serviceEndpoints,this.getPollingPaths(),this.platform.requests,this.platform.encoding,this.baseHeaders,[],this.config.withReasons,this.config.useReport,this.qt);this.createStreamingProcessor(r,e,o,n,s),this.updateProcessor.start()}};function Si(i){let e=Mt("visibilitychange",()=>{bi()==="hidden"&&i()}),n=Rt("pagehide",i);return()=>{e(),n()}}function it(i){if(typeof i!="string")throw new TypeError("Expected a string");return i.replace(/[|\\{}()[\]^$+*?.]/g,"\\$&").replace(/-/g,"\\x2d")}function ts(i,t,e,n){let r=((i.kind==="substring"||i.kind==="regex")&&n.includes("/")?t:t.replace(n,"")).replace(e,"");switch(i.kind){case"exact":return new RegExp(`^${it(i.url)}/?$`).test(t);case"canonical":return new RegExp(`^${it(i.url)}/?$`).test(r);case"substring":return new RegExp(`.*${it(i.substring)}.*$`).test(r);case"regex":return new RegExp(i.pattern).test(r);default:return!1}}function es(i,t){let e=[];return t.forEach(n=>{let s=i.target,{selector:r}=n,a=ki(r);for(;s&&(a!=null&&a.length);){for(let o=0;o<a.length;o+=1)if(s===a[o]){e.push(n);break}s=s.parentNode}}),e}var nt=class{constructor(t,e){let n=t.filter(a=>{var o;return(o=a.urls)==null?void 0:o.some(c=>ts(c,C(),wi(),Ei()))}),s=n.filter(a=>a.kind==="pageview"),r=n.filter(a=>a.kind==="click");if(s.forEach(a=>e(a)),r.length){let a=o=>{es(o,r).forEach(c=>{e(c)})};this.Ne=Mt("click",a)}}close(){var t;(t=this.Ne)==null||t.call(this)}};var is=300,Ft=class{constructor(t){this.Wt=C();let e=()=>{let s=C();s!==this.Wt&&(this.Wt=s,t())};this.Yt=setInterval(e,is);let n=Rt("popstate",e);this.Oe=()=>{n()}}close(){var t;this.Yt&&clearInterval(this.Yt),(t=this.Oe)==null||t.call(this)}};var st=class{constructor(t,e,n,s,r,a=o=>new Ft(o)){this.L=e;this.en=s;this.tn=r;this.wt=[];this.Me=!1;this.Et=`${n}/sdk/goals/${t}`,this.$e=a(()=>{this.Xt()})}async initialize(){await this.Qi(),this.Xt()}startTracking(){this.Me=!0,this.Xt()}Xt(){var t;this.Me&&((t=this.Zt)==null||t.close(),this.wt&&this.wt.length&&(this.Zt=new nt(this.wt,e=>{this.tn(C(),e)})))}async Qi(){try{let t=await this.L.fetch(this.Et);this.wt=await t.json()}catch(t){this.en(new q(`Encountered error fetching goals: ${t}`))}}close(){var t,e;(t=this.$e)==null||t.close(),(e=this.Zt)==null||e.close()}};function Li(i){return i.kind==="click"}var ns=2,Ci={fetchGoals:!0,eventUrlTransformer:i=>i,streaming:void 0,plugins:[]},ss={fetchGoals:u.Boolean,eventUrlTransformer:u.Function,streaming:u.Boolean,plugins:u.createTypeArray("LDPlugin",{})};function rs(i){var e;let t=p({},i);return(e=t.flushInterval)!=null||(t.flushInterval=ns),t}function Ti(i){let t=rs(i);return Object.keys(Ci).forEach(e=>{delete t[e]}),t}function Oe(i,t){let e=p({},Ci);return Object.entries(ss).forEach(n=>{let[s,r]=n,a=i[s];a!==void 0&&(r.is(a)?e[s]=a:t.warn(b.wrongOptionType(s,r.getType(),typeof a)))}),e}var rt=class{constructor(t,e){this.nn=t;this.Re=[];switch(e){case"sha1":this.Qt="SHA-1";break;case"sha256":this.Qt="SHA-256";break;default:throw new Error(`Algorithm is not supported ${e}`)}}async asyncDigest(t){let e=this.Re.join(""),n=new TextEncoder().encode(e),s=await this.nn.subtle.digest(this.Qt,n);switch(t){case"base64":return btoa(String.fromCharCode(...new Uint8Array(s)));case"hex":return[...new Uint8Array(s)].map(r=>r.toString(16).padStart(2,"0")).join("");default:throw new Error(`Encoding is not supported ${t}`)}}update(t){return this.Re.push(t),this}};var as={start:0,end:3},os={start:4,end:5},$e={start:6,end:7},Me={start:8,end:8},cs={start:9,end:9},ls={start:10,end:15};function us(){if(crypto&&crypto.getRandomValues){let t=new Uint8Array(16);return crypto.getRandomValues(t),[...t.values()]}let i=[];for(let t=0;t<16;t+=1)i.push(Math.floor(Math.random()*256));return i}function _(i,t){let e="";for(let n=t.start;n<=t.end;n+=1)e+=i[n].toString(16).padStart(2,"0");return e}function hs(i){return i[Me.start]=(i[Me.start]|128)&191,i[$e.start]=i[$e.start]&15|64,`${_(i,as)}-${_(i,os)}-${_(i,$e)}-${_(i,Me)}${_(i,cs)}-${_(i,ls)}`}function ds(){let i=us();return hs(i)}function Re(){return typeof crypto!==void 0&&typeof crypto.randomUUID=="function"?crypto.randomUUID():ds()}var at=class{createHash(t){return new rt(Di(),t)}randomUUID(){return Re()}};function fs(i){let t=Array.from(i,e=>String.fromCodePoint(e)).join("");return btoa(t)}var ot=class{btoa(t){return fs(new TextEncoder().encode(t))}};var ct=class{constructor(t){this.r=t}platformData(){return{name:"JS"}}sdkData(){let t={name:"@launchdarkly/js-client-sdk",version:"0.0.0",userAgentBase:"JSClient"};return this.r.wrapperName&&(t.wrapperName=this.r.wrapperName),this.r.wrapperVersion&&(t.wrapperVersion=this.r.wrapperVersion),t}};var lt=class{constructor(t,e){this.Et=t;this.e={};this.x=new Et(e.initialRetryDelayMillis,e.retryResetIntervalMillis),this.Fe=e.errorFilter,this.Ue()}Ue(){this.W=new EventSource(this.Et),this.W.onopen=()=>{var t;this.x.success(),(t=this.onopen)==null||t.call(this)},this.W.onerror=t=>{var e;this.sn(t),(e=this.onerror)==null||e.call(this,t)},Object.entries(this.e).forEach(([t,e])=>{e.forEach(n=>{var s;(s=this.W)==null||s.addEventListener(t,n)})})}addEventListener(t,e){var n,s,r;(s=(n=this.e)[t])!=null||(n[t]=[]),this.e[t].push(e),(r=this.W)==null||r.addEventListener(t,e)}close(){var t,e;clearTimeout(this.te),this.te=void 0,(t=this.W)==null||t.close(),(e=this.onclose)==null||e.call(this)}rn(t){var e;(e=this.onretrying)==null||e.call(this,{delayMillis:t}),this.te=setTimeout(()=>{this.Ue()},t)}sn(t){this.close(),!(t.status&&typeof t.status=="number"&&!this.Fe(t))&&this.rn(this.x.fail())}};var ut=class{fetch(t,e){return fetch(t,e)}createEventSource(t,e){return new lt(t,e)}getEventSourceCapabilities(){return{customMethod:!1,readTimeout:!1,headers:!1}}};function Ai(){return typeof localStorage!="undefined"}var ht=class{constructor(t){this.t=t}async clear(t){var e;try{localStorage.removeItem(t)}catch(n){(e=this.t)==null||e.error(`Error clearing key from localStorage: ${t}, reason: ${n}`)}}async get(t){var e;try{let n=localStorage.getItem(t);return n!=null?n:null}catch(n){return(e=this.t)==null||e.error(`Error getting key from localStorage: ${t}, reason: ${n}`),null}}async set(t,e){var n;try{localStorage.setItem(t,e)}catch(s){(n=this.t)==null||n.error(`Error setting key in localStorage: ${t}, reason: ${s}`)}}};var dt=class{constructor(t,e){this.encoding=new ot;this.crypto=new at;this.requests=new ut;Ai()&&(this.storage=new ht(t)),this.info=new ct(e)}};var Ut=class extends Nt{constructor(t,e,n={},s){var g;let{logger:r,debug:a}=n,o=r!=null?r:new $({destination:{debug:console.debug,info:console.info,warn:console.warn,error:console.error},level:a?"debug":"info"}),c=(g=n.baseUri)!=null?g:"https://clientsdk.launchdarkly.com",l=s!=null?s:new dt(o,n),h=Oe(n,o),d=Ti(D(p({},n),{logger:o})),{eventUrlTransformer:f}=h;super(t,e,l,d,(m,y,L,R,Pi)=>new et(l,m,t,y,h,()=>({pathGet(I,P){return`/sdk/evalx/${t}/contexts/${de(P,I)}`},pathReport(I,P){return`/sdk/evalx/${t}/context`},pathPing(I,P){throw new Error("Ping for polling unsupported.")}}),()=>({pathGet(I,P){return`/eval/${t}/${de(P,I)}`},pathReport(I,P){return`/eval/${t}`},pathPing(I,P){return`/ping/${t}`}}),L,R,Pi),{analyticsEventPath:`/events/bulk/${t}`,diagnosticEventPath:`/events/diagnostic/${t}`,includeAuthorizationHeader:!1,highTimeoutThreshold:5,userAgentHeaderName:"x-launchdarkly-user-agent",trackEventModifier:m=>new x.InputCustomEvent(m.context,m.key,m.data,m.metricValue,m.samplingRatio,f(C())),getImplementationHooks:m=>x.safeGetHooks(o,m,h.plugins),credentialType:"clientSideId"}),this.setEventSendingEnabled(!0,!1),h.fetchGoals&&(this.ee=new st(t,l.requests,c,m=>{o.error(m.message)},(m,y)=>{let L=this.getInternalContext();if(!L)return;let R=f(m);Li(y)?this.sendEvent({kind:"click",url:R,samplingRatio:1,key:y.key,creationDate:Date.now(),context:L,selector:y.selector}):this.sendEvent({kind:"pageview",url:R,samplingRatio:1,key:y.key,creationDate:Date.now(),context:L})}),this.ee.initialize(),h.automaticBackgroundHandling&&Si(()=>this.flush())),x.safeRegisterPlugins(o,this.environmentMetadata,this,h.plugins)}async identify(t,e){var n;await super.identify(t,e),(n=this.ee)==null||n.startTracking()}setStreaming(t){this.dataManager.setForcedStreaming(t)}Ve(){this.dataManager.setAutomaticStreamingState(!!this.emitter.listenerCount("change"))}on(t,e){super.on(t,e),this.Ve()}off(t,e){super.off(t,e),this.Ve()}};var Ii=["ready","failed","initialized"],ft=class{constructor(t){this.n=t;this.e=new Map}on(t,e){var n;Ii.includes(t)?this.e.has(t)?(n=this.e.get(t))==null||n.push(e):this.e.set(t,[e]):this.n.on(t,e)}off(t,e){if(Ii.includes(t)){let n=this.e.get(t);if(!n)return;if(e){let s=n.filter(r=>r!==e);s.length===0?this.e.delete(t):this.e.set(t,s);return}this.e.delete(t)}else this.n.off(t,e)}Vt(t,e,...n){try{t(...n)}catch(s){this.n.logger.error(`Encountered error invoking handler for "${e}", detail: "${s}"`)}}emit(t,...e){let n=this.e.get(t);n==null||n.forEach(s=>this.Vt(s,t,...e))}eventNames(){return[...this.e.keys()]}listenerCount(t){var e,n;return(n=(e=this.e.get(t))==null?void 0:e.length)!=null?n:0}};function Vt(i,t){let e=i.then(n=>(t&&setTimeout(()=>{t(null,n)},0),n),n=>{if(t)setTimeout(()=>{t(n,null)},0);else return Promise.reject(n)});return t?void 0:e}var pt=class{constructor(t,e,n){this.ie="initializing";let s=n==null?void 0:n.bootstrap,r=n==null?void 0:n.hash,a=p({},n);delete a.bootstrap,delete a.hash,this.n=new Ut(t,V.Disabled,n),this.A=new ft(this.n),this.logger=this.n.logger,this.an(e,s,r)}async an(t,e,n){var s,r;try{await this.n.identify(t,{noTimeout:!0,bootstrap:e,hash:n}),this.ie="success",(s=this.je)==null||s.call(this),this.A.emit("initialized")}catch(a){this.Be=a,this.ie="failure",(r=this.He)==null||r.call(this,a),this.A.emit("failed",a)}this.A.emit("ready")}allFlags(){return this.n.allFlags()}boolVariation(t,e){return this.n.boolVariation(t,e)}boolVariationDetail(t,e){return this.n.boolVariationDetail(t,e)}jsonVariation(t,e){return this.n.jsonVariation(t,e)}jsonVariationDetail(t,e){return this.n.jsonVariationDetail(t,e)}numberVariation(t,e){return this.n.numberVariation(t,e)}numberVariationDetail(t,e){return this.n.numberVariationDetail(t,e)}off(t,e){this.A.off(t,e)}on(t,e){this.A.on(t,e)}stringVariation(t,e){return this.n.stringVariation(t,e)}stringVariationDetail(t,e){return this.n.stringVariationDetail(t,e)}track(t,e,n){this.n.track(t,e,n)}variation(t,e){return this.n.variation(t,e)}variationDetail(t,e){return this.n.variationDetail(t,e)}addHook(t){this.n.addHook(t)}setStreaming(t){this.n.setStreaming(t)}identify(t,e,n){return Vt(this.n.identify(t,{hash:e}).then(()=>this.allFlags()),n)}close(t){return Vt(this.n.close().then(),t)}flush(t){return Vt(this.n.flush().then(()=>{}),t)}getContext(){return this.n.getContext()}waitForInitialization(t){var e;if(this.it)return this._e(this.it,t);switch(this.ie){case"success":return Promise.resolve();case"failure":return Promise.reject(this.Be);case"initializing":break;default:throw new Error("Unexpected initialization state. This represents an implementation error in the SDK.")}return t===void 0&&((e=this.logger)==null||e.warn("The waitForInitialization function was called without a timeout specified. In a future version a default timeout will be applied.")),this.it||(this.it=new Promise((n,s)=>{this.je=n,this.He=s})),this._e(this.it,t)}async waitUntilReady(){try{await this.waitForInitialization()}catch(t){}}_e(t,e){if(e){let n=Qe(e,"waitForInitialization");return Promise.race([t.then(()=>n.cancel()),n.promise]).catch(s=>{var r;throw s instanceof H&&((r=this.logger)==null||r.error(s.message)),s})}return t}};function ga(i){return new $(i)}function va(i,t,e){return new pt(i,t,e)}export{ga as basicLogger,va as initialize};
//# sourceMappingURL=compat.js.map